{% extends "plantilla.html" %}
{% load static %}

{% block content %}
<style>
    .card {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .card-header {
        border-radius: 10px 10px 0 0 !important;
    }
    .list-group-item {
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .list-group-item:hover {
        background-color: #f8f9fa;
    }
    .list-group-item.active {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .central-img {
        max-height: 200px;
        object-fit: cover;
        border-radius: 8px;
    }
    .badge-tipo {
        font-size: 0.8em;
        padding: 5px 10px;
        border-radius: 20px;
    }
    .tab-content {
        padding: 20px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 10px 10px;
    }
</style>
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="fw-bold">Centrales de Generación {{ tipo.nombre }}</h2>
            <p class="lead text-muted">Seleccione una central para ver sus detalles</p>
        </div>
        <!--<div class="col-md-4">
            <div class="search-box">
                <div class="input-group shadow-sm rounded">
                    <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                    <input type="text" id="buscador-central" class="form-control" placeholder="Buscar central...">
                </div>
            </div>
        </div> -->
    </div>
    <div class="row">
        
    </div>

    <div class="row">
        <!-- Lista de Centrales -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-bolt me-2"></i>Listado de Centrales
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="lista-centrales">
                        <form method="post" class="mb-3 px-2 py-2">
                            {% csrf_token %}
                            <select name="central_id" id="central" class="form-select" onchange="this.form.submit()">
                                <option value="">-- Selecciona --</option>
                                {% for c in centrales %}
                                <option value="{{ c.id }}"
                                    {% if central_seleccionada and c.id == central_seleccionada.id %}selected{% endif %}>
                                    {{ c.nombre }} - {{ c.tipo_especifico|title }}
                                </option>
                                {% endfor %}
                            </select>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de Visualización -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-info-circle me-2"></i>
                    <span id="titulo-central">Seleccione una central</span>
                </div>
                <div class="card-body" id="panel-central">
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-bolt fa-3x mb-3"></i>
                        <p>Seleccione una central del listado para ver sus detalles</p>

                        {% if central_seleccionada %}
                            <hr>
                            <h4>Información de la central: {{ central_seleccionada.nombre }}</h4>
                            <ul>
                                <li><strong>Foto:</strong> {{ central_seleccionada.central.foto_central }}</li>
                                <li><strong>Ubicación:</strong> {{ central_seleccionada.provincia }}, {{ central_seleccionada.canton }}</li>
                                <li><strong>Empresa:</strong> {{ central_seleccionada.empresa }}</li>
                                <li><strong>Tipo:</strong> {{ central_seleccionada.tipo }}</li>
                                <li><strong>Potencia:</strong> {{ central_seleccionada.potencia }} MW</li>
                                <li><strong>Inicio operación:</strong> {{ central_seleccionada.anio_operacion }}</li>
                            </ul>

                            {% if resultado %}
                                <hr>
                                <h4>Resultado del Cálculo LCOE</h4>
                                <p><strong>LCOE:</strong> {{ resultado.lcoe }} USD/kWh</p>
                                <p><strong>Fecha del cálculo:</strong> {{ resultado.fecha_calculo }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                
            </div>
        </div>     
    </div>
</div>

<!-- Template para los detalles -->
<template id="template-detalle">
    <div>
        <ul class="nav nav-tabs mb-3" id="centralTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button">Datos Generales</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tecnica-tab" data-bs-toggle="tab" data-bs-target="#tecnica" type="button">Ficha Técnica</button>
            </li>
        </ul>
        <div class="tab-content" id="centralTabsContent">
            <div class="tab-pane fade show active" id="general" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <img id="central-foto" src="" class="img-fluid rounded mb-3" alt="Foto de la central" style="max-height: 200px;">
                    </div>
                    <div class="col-md-8">
                        <h4 id="central-nombre"></h4>
                        <p class="text-muted" id="central-empresa"></p>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <p><i class="fas fa-map-marker-alt"></i> <strong>Ubicación:</strong> <span id="central-ubicacion"></span></p>
                                <p><i class="fas fa-bolt"></i> <strong>Potencia:</strong> <span id="central-potencia"></span> MW</p>
                            </div>
                            <div class="col-md-6">
                                <p><i class="fas fa-chart-line"></i> <strong>Energía Media:</strong> <span id="central-energia"></span> MWh</p>
                                <p><i class="fas fa-calendar-alt"></i> <strong>Año Operación:</strong> <span id="central-anio"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <h5>Localización</h5>
                        <p><strong>Provincia:</strong> <span id="central-provincia"></span></p>
                        <p><strong>Cantón:</strong> <span id="central-canton"></span></p>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="tecnica" role="tabpanel">
                <div id="ficha-tecnica-content"></div>
            </div>
        </div>
    </div>
</template>

<!-- Templates para fichas técnicas -->
<template id="template-termica">
    <div>
        <h4>Central Térmica</h4>
        <div class="row">
            <div class="col-md-6">
                <h5>Costos de Operación (USD)</h5>
                <table class="table table-sm">
                    <tr><th>Producción:</th><td id="ct-produccion"></td></tr>
                    <tr><th>Operación y Mantenimiento:</th><td id="ct-om"></td></tr>
                    <tr><th>Administración:</th><td id="ct-administracion"></td></tr>
                </table>
            </div>
            <div class="col-md-6">
                <h5>Costos Específicos (USD)</h5>
                <table class="table table-sm">
                    <tr><th>Combustible:</th><td id="ct-combustible"></td></tr>
                    <tr><th>Transporte:</th><td id="ct-transporte"></td></tr>
                    <tr><th>Lubricación:</th><td id="ct-lubricacion"></td></tr>
                    <tr><th>Agua:</th><td id="ct-agua"></td></tr>
                    <tr><th>Mantenimiento:</th><td id="ct-mantenimiento"></td></tr>
                </table>
            </div>
        </div>
    </div>
</template>

<template id="template-fotovoltaica">
    <div>
        <h4>Central Fotovoltaica</h4>
        <div class="row">
            <div class="col-md-6">
                <h5>Costos de Operación (USD)</h5>
                <table class="table table-sm">
                    <tr><th>Producción:</th><td id="cf-produccion"></td></tr>
                    <tr><th>Operación y Mantenimiento:</th><td id="cf-om"></td></tr>
                    <tr><th>Variables:</th><td id="cf-variables"></td></tr>
                </table>
            </div>
        </div>
    </div>
</template>
{% endblock %}